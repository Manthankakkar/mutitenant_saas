
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Super Admin Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f6f9;
    }

    header {
      background: #2d3e50;
      color: white;
      padding: 15px;
      text-align: center;
    }

    main {
      padding: 20px;
    }

    h2 {
      margin-bottom: 10px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: center;
    }

    th {
      background: #2d3e50;
      color: white;
    }

    button {
      padding: 6px 10px;
      margin: 2px;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }
    #logout{
    
      padding: 6px 10px;
      margin: 50px;
      border: none;
      cursor: pointer;
      border-radius: 4px;
      background-color: black;
      border-radius: 5px;
      color: azure;

    
    }

    button.suspend { background: #f39c12; color: white; }
    button.upgrade { background: #27ae60; color: white; }
    button.downgrade { background: #2980b9; color: white; }
    button.delete { background: #e74c3c; color: white; }

  
    .status-active { color: green; font-weight: bold; }
    .status-suspended { color: orange; font-weight: bold; }
    .status-deleted { color: red; font-weight: bold; }

  
    .plan-free { color: gray; font-weight: bold; }
    .plan-basic { color: blue; font-weight: bold; }
    .plan-pro { color: purple; font-weight: bold; }
    .plan-enterprise { color: gold; font-weight: bold; }
  </style>
</head>
<body>
  <header>
    <h1>Super Admin Dashboard</h1>
  </header>

  <main>
    <section class="tenant-list">
      <h2>All Tenants</h2>
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Domain</th>
            <th>Plan</th>
            <th>Status</th>
            <th>Users</th>
            <th>API Calls</th>
            <th>Storage</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="tenantTableBody">
        </tbody>
      </table>
    </section>
    <button id="logout">Logout</button>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    const token = localStorage.getItem("token");
    const API_URL = "http://localhost:5000/api/superadmin/tenants"; 

    document.addEventListener("DOMContentLoaded", fetchTenants);

    function getStatusClass(status) {
      return status === "active" ? "status-active" :
             status === "suspended" ? "status-suspended" :
             "status-deleted";
    }

    function getPlanClass(plan) {
      return plan === "free" ? "plan-free" :
             plan === "basic" ? "plan-basic" :
             plan === "pro" ? "plan-pro" :
             "plan-enterprise";
    }

    async function fetchTenants() {
      try {
        const res = await axios.get(API_URL, {
          headers: { Authorization: "Bearer " + token }
        });

        const tenants = res.data;
        const tableBody = document.getElementById("tenantTableBody");
        tableBody.innerHTML = "";

        tenants.forEach(tenant => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${tenant.name}</td>
            <td>${tenant.domain || "-"}</td>
            <td class="${getPlanClass(tenant.plan)}">${tenant.plan}</td>
            <td class="${getStatusClass(tenant.status)}">${tenant.status}</td>
            <td>${tenant.usage?.users || 0}</td>
            <td>${tenant.usage?.apiCalls || 0}</td>
            <td>${tenant.usage?.storage || 0} MB</td>
            <td>
              <button class="suspend" onclick="updateTenant('${tenant._id}', 'suspend')">Suspend</button>
              <button class="upgrade" onclick="updateTenant('${tenant._id}', 'upgrade')">Upgrade</button>
              <button class="downgrade" onclick="updateTenant('${tenant._id}', 'downgrade')">Downgrade</button>
              <button class="delete" onclick="deleteTenant('${tenant._id}')">Delete</button>
            </td>
          `;
          tableBody.appendChild(row);
        });
      } catch (err) {
        console.error("Error fetching tenants:", err);
        alert("Failed to load tenants.");
      }
    }

    async function updateTenant(id, action) {
      try {
        let data = {};
        let url;

        if (action === "suspend") {
          data.status = "suspended";
          url = `${API_URL}/${id}/status`;
        } else if (action === "upgrade") {
          data.plan = "pro"; 
          url = `${API_URL}/${id}/plan`;
        } else if (action === "downgrade") {
          data.plan = "basic"; 
          url = `${API_URL}/${id}/plan`;
        }

        await axios.put(url, data, { headers: { Authorization: `Bearer ${token}` } });

        alert(`Tenant ${action}d successfully!`);
        fetchTenants();
      } catch (err) {
        console.error(`Error performing ${action}:`, err);
        alert("Action failed.");
      }
    }

    async function deleteTenant(id) {
      if (!confirm("Are you sure you want to delete this tenant?")) return;
      try {
        const res = await axios.delete(`${API_URL}/${id}`, {
          headers: { Authorization: `Bearer ${token}` }
        });
        alert(res.data.message || "Tenant deleted successfully!");
        fetchTenants();
      } catch (err) {
        console.error("Error deleting tenant:", err);
        alert(err.message || "Delete failed.");
      }
    }
    const logout=document.getElementById("logout")
    logout.addEventListener("click",()=>{
      window.location.href="login.html"
    })
  </script>
</body>
</html>
